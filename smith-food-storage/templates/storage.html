<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Smith Food Storage | My Storage</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Rock+Salt&family=Roboto&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">

  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">

  <style>
    .sort-select { margin: 1em 0; }
    input.inline-edit, select.inline-edit {
      border: 1px solid transparent;
      transition: border-color .2s;
      width: 100%;
      box-sizing: border-box;
    }
    input.inline-edit:hover, select.inline-edit:hover {
      border-color: #aaa;
    }
    input.inline-edit:focus, select.inline-edit:focus {
      border-color: #333;
      outline: none;
    }
    .btn-delete {
      background: transparent;
      border: none;
      color: red;
      font-size: 1.2em;
      cursor: pointer;
    }
    table.dataTable { width: 100% !important; }
  </style>

</head>
<body>
  <div id="content">
    <!-- Header -->
    <header>
      <div class="nav-icons">
        <a href="{{ url_for('home') }}">
          <img class="logo"src="{{ url_for('static', filename='images/updated_smith_food_storage_logo.jpg') }}"alt="Smith Food Storage">
        </a>
        <a href="{{ url_for('add_food') }}">
          <img class="logo" src="{{ url_for('static', filename='images/addfoodlogo.jpg') }}" alt="Add Food">
        </a>
        <a href="{{ url_for('storage') }}">
          <img class="logo" src="{{ url_for('static', filename='images/mystoragelogo.jpg') }}" alt="My Storage">
        </a>
      </div>
    </header>

    <!-- Text -->
    <section id="scenery-overlay">
      <div class="overlay-msg">
        <h2>My Storage</h2>
        <p>This is where you can see all of the food you added from the Add Food page. There is a sort bar to help with organization, so that when an item is used up etc. you can easily update the list. You can also order the items by which expiration dates are coming up sooner so that the food can be used up and swapped out.</p>
      </div>
    </section>

  <!-- Hero Section-->
  <div id="hero">
    <div id="hero-box">
      <img id="hero-img" src="{{ url_for('static', filename='images/mystoragecan.jpg') }}" alt="Add Food">
    </div>
    <section id="hero-msg">
      <h1 class="home-title">Storage Calculations</h1>
      <div class="button-box">
        <a class="book" href="{{ url_for('run_program') }}">Storage Tools</a>
      </div>
    </section>
  </div>

  <!-- Question -->
  <select id="sortBy" class="sort-select">
    <option value="0">Name (A→Z)</option>
    <option value="1">Qty (high→low)</option>
    <option value="2">Expires (soonest→latest)</option>
    <option value="4">Store (A→Z)</option>
    <option value="5">Category (A→Z)</option>
    <option value="6">Location (A→Z)</option>
  </select>


  <!-- Storage Table -->
  <main>
    {% if items %}
    <table id="storage-table" class="display">
      <thead>
        <tr>
          <th>Name</th>
          <th>Qty</th>
          <th>Expires</th>
          <th>Price</th>
          <th>Store</th>
          <th>Category</th>
          <th>Location</th>
          <th>Del</th>
        </tr>
      </thead>
      <tbody>
        {% for i in items %}
        <tr data-item-id="{{ i.item_id }}">
          <td><input type="text" class="inline-edit" data-field="name"  value="{{ i.name }}"></td>
          <td><input type="number" class="inline-edit" data-field="quantity" value="{{ i.quantity }}"></td>
          <td><input type="date" class="inline-edit" data-field="expires" value="{{ i.expires or '' }}"></td>
          <td>
            {% if i.purchase_price %}
              ${{ '%.2f'|format(i.purchase_price) }}
            {% else %}
              &ndash;
            {% endif %}
          </td>
          <td>{{ i.store.name if i.store else '—' }}</td>
          <td><select class="inline-edit" data-field="category_id">
            <option value="">—</option>
            {% for id,name in categories.items() %}
              <option value="{{ id }}" {% if id==i.category_id %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
          </select></td>
          <td><select class="inline-edit" data-field="location_id">
            <option value="">—</option>
            {% for id,name in locations.items() %}
              <option value="{{ id }}" {% if id==i.location_id %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
          </select></td>
          <td>
            <form action="{{ url_for('delete_item', item_id=i.item_id) }}"
                  method="post" style="display:inline">
              <button type="submit" class="btn-delete">&times;</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <p>No items yet. <a href="{{ url_for('add_food') }}">Add some.</a></p>
    {% endif %}
  </main>

  <!-- Footer -->
  <footer>
    <div class="footer-left">Smith Food Storage &copy; 2025 - Trevor Smith</div>
    <div class="footer-center"><a href="{{ url_for('site_plan') }}">Site Plan</a></div>
    <div class="footer-right"><a href="{{ url_for('contact_us') }}">Contact Us</a></div>
    <div class="footer-right"><a href="{{ url_for('run_program') }}">Storage Tools</a></div>
  
    <div class="social">
      <a href="https://facebook.com" target="_blank">
        <img src="{{ url_for('static', filename='images/facebook.png') }}" alt="Facebook icon">
      </a>
      <a href="https://twitter.com" target="_blank"><img src="{{ url_for('static', filename='images/twitter.png') }}" alt="Twitter icon">
      </a>
      <a href="https://instagram.com" target="_blank"><img src="{{ url_for('static', filename='images/instagram.png') }}" alt="Instagram icon">
      </a>
    </div>
  </footer>

  <!-- DataTables JS dependencies -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

  <script>
    $(document).ready(function(){
      // Initialize DataTables on your storage table
      const table = $('#storage-table').DataTable({
        paging:    false,
        info:      false,
        searching: false,
        ordering:  true,
        order:     [[ 2, 'asc' ]]  // default: sort Expires ascending
      });

      // Re-sort when the dropdown changes
      $('#sortBy').on('change', function(){
        const colIndex = parseInt(this.value, 10);
        let dir = 'asc';
        // For Quantity, we want high→low
        if (colIndex === 1) dir = 'desc';
        table.order([ colIndex, dir ]).draw();
      });

      // Inline edits: POST back to /edit-item/<id>
      $('.inline-edit').on('change', function(){
        const row = $(this).closest('tr'),
              id  = row.data('item-id'),
              field = $(this).data('field'),
              value = $(this).val();
        $.post(`/edit-item/${id}`, { field, value });
      });
    });
  </script>
</body>
</html>
