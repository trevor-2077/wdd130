<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Rock+Salt&family=Roboto&display=swap"
    rel="stylesheet"
  >
  <!-- your own styles -->
  <link
    rel="stylesheet"
    href="{{ url_for('static', filename='styles/style.css') }}"
  >

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smith Food Storage | My Storage</title>

  <style>
    table { width:100%; border-collapse: collapse; margin-top:1em; }
    th, td { border:1px solid #ddd; padding:0.5em; position: relative; }
    th { background:#f4f4f4; }
    /* hide the inline editors until you interact */
    .inline-edit {
      border: none;
      background: transparent;
      width: 100%;
      box-sizing: border-box;
      padding: 0;
      margin: 0;
      font: inherit;
      color: inherit;
    }
    /* on hover of the cell show a subtle dashed hint */
    td:hover {
      outline: 1px dashed #ccc;
    }
    /* when you focus the input/select, show a solid border */
    .inline-edit:focus {
      outline: none;
      border: 1px solid #888;
      background: #fff;
      padding: 0.25em;
    }
    .btn-delete {
      background: transparent;
      border: none;
      color: red;
      font-size: 1.2em;
      cursor: pointer;
    }
    .sort-select {
      margin-top: 0.5em;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <div id="content">

    <!-- Header -->
    <header>
      <div class="nav-icons">
        <a href="{{ url_for('home') }}">
          <img class="logo"
               src="{{ url_for('static', filename='images/updated_smith_food_storage_logo.jpg') }}"
               alt="Home">
        </a>
        <a href="{{ url_for('add_food') }}">
          <img class="logo"
               src="{{ url_for('static', filename='images/addfoodlogo.jpg') }}"
               alt="Add Food">
        </a>
        <a href="{{ url_for('storage') }}">
          <img class="logo"
               src="{{ url_for('static', filename='images/mystoragelogo.jpg') }}"
               alt="My Storage">
        </a>
      </div>
    </header>

    <!-- Sorting controls -->
    <label for="sort-by">Sort by:</label>
    <select id="sort-by" class="sort-select">
      <option value="name">Name</option>
      <option value="quantity">Quantity</option>
      <option value="expires">Expiration</option>
      <option value="store">Store</option>
      <option value="category">Category</option>
      <option value="location">Location</option>
    </select>

    <!-- Storage Table -->
    <main>
      {% if items %}
      <table id="storage-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Qty</th>
            <th>Expires</th>
            <th>Price</th>
            <th>Store</th>
            <th>Category</th>
            <th>Location</th>
            <th>Del</th>
          </tr>
        </thead>
        <tbody>
          {% for i in items %}
          <tr data-item="{{ i.item_id }}">
            <td>
              <input type="text" value="{{ i.name }}"
                     class="inline-edit"
                     data-field="name">
            </td>
            <td>
              <input type="number" min="0" value="{{ i.quantity }}"
                     class="inline-edit"
                     data-field="quantity">
            </td>
            <td>
              <input type="date" value="{{ i.expires or '' }}"
                     class="inline-edit"
                     data-field="expires">
            </td>
            <td>
              <input type="number" step="0.01" value="{{ i.purchase_price or '' }}"
                     class="inline-edit"
                     data-field="purchase_price">
            </td>
            <td>
              <select class="inline-edit" data-field="store_id">
                <option value="">—</option>
                {% for s in stores %}
                <option value="{{ s.store_id }}"
                  {% if i.store and i.store.store_id==s.store_id %}selected{% endif %}>
                  {{ s.name }}
                </option>
                {% endfor %}
              </select>
            </td>
            <td>
              <select class="inline-edit" data-field="category_id">
                <option value="">—</option>
                {% for c in categories %}
                <option value="{{ c.category_id }}"
                  {% if i.category and i.category.category_id==c.category_id %}selected{% endif %}>
                  {{ c.name }}
                </option>
                {% endfor %}
              </select>
            </td>
            <td>
              <select class="inline-edit" data-field="location_id">
                <option value="">—</option>
                {% for l in locations %}
                <option value="{{ l.location_id }}"
                  {% if i.location and i.location.location_id==l.location_id %}selected{% endif %}>
                  {{ l.name }}
                </option>
                {% endfor %}
              </select>
            </td>
            <td>
              <form action="{{ url_for('delete_item', item_id=i.item_id) }}"
                    method="post" style="display:inline">
                <button type="submit" class="btn-delete" title="Delete">
                  &times;
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <p>No items yet. <a href="{{ url_for('add_food') }}">Add some.</a></p>
      {% endif %}
    </main>

    <!-- Footer -->
    <footer>
      <div class="footer-left">
        Smith Food Storage &copy; 2025 – Trevor Smith
      </div>
      <div class="footer-links">
        <a href="{{ url_for('site_plan') }}">Site Plan</a>
        <a href="{{ url_for('contact_us') }}">Contact Us</a>
        <a href="{{ url_for('run_program') }}">Analysis</a>
      </div>
      <div class="social">
        <a href="https://facebook.com" target="_blank">
          <img
            src="{{ url_for('static', filename='images/facebook.png') }}"
            alt="Facebook">
        </a>
        <a href="https://twitter.com" target="_blank">
          <img
            src="{{ url_for('static', filename='images/twitter.png') }}"
            alt="Twitter">
        </a>
        <a href="https://instagram.com" target="_blank">
          <img
            src="{{ url_for('static', filename='images/instagram.png') }}"
            alt="Instagram">
        </a>
      </div>
    </footer>

  </div>

  <script>
    // Sorting
    document.getElementById('sort-by').addEventListener('change', function() {
      const col = this.value;
      const table = document.getElementById('storage-table');
      const rows = Array.from(table.tBodies[0].rows);
      const idx = {
        name: 0, quantity: 1, expires: 2,
        price: 3, store: 4, category: 5, location: 6
      }[col];
      rows.sort((a,b) => {
        let aText = a.cells[idx].innerText || '';
        let bText = b.cells[idx].innerText || '';
        return aText.localeCompare(bText, undefined, { numeric: true });
      });
      rows.forEach(r => table.tBodies[0].appendChild(r));
    });

    // Inline edit handlers
    document.querySelectorAll('.inline-edit').forEach(el => {
      el.addEventListener('change', async function() {
        const tr = el.closest('tr');
        const id = tr.dataset.item;
        const payload = {};
        payload[el.dataset.field] = el.value;
        await fetch(`/update/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      });
    });
  </script>
</body>
</html>
